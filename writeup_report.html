<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>writeup_report</title>
      <style>.markdown-preview:not([data-use-github-style]) { padding: 2em; font-size: 1.2em; color: rgb(85, 85, 85); overflow: auto; background-color: white; }
.markdown-preview:not([data-use-github-style]) > :first-child { margin-top: 0px; }
.markdown-preview:not([data-use-github-style]) h1, .markdown-preview:not([data-use-github-style]) h2, .markdown-preview:not([data-use-github-style]) h3, .markdown-preview:not([data-use-github-style]) h4, .markdown-preview:not([data-use-github-style]) h5, .markdown-preview:not([data-use-github-style]) h6 { line-height: 1.2; margin-top: 1.5em; margin-bottom: 0.5em; color: rgb(3, 3, 3); }
.markdown-preview:not([data-use-github-style]) h1 { font-size: 2.4em; font-weight: 300; }
.markdown-preview:not([data-use-github-style]) h2 { font-size: 1.8em; font-weight: 400; }
.markdown-preview:not([data-use-github-style]) h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview:not([data-use-github-style]) h4 { font-size: 1.2em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h6 { font-size: 1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) strong { color: rgb(3, 3, 3); }
.markdown-preview:not([data-use-github-style]) del { color: rgb(126, 126, 126); }
.markdown-preview:not([data-use-github-style]) a, .markdown-preview:not([data-use-github-style]) a code { color: black; }
.markdown-preview:not([data-use-github-style]) img { max-width: 100%; }
.markdown-preview:not([data-use-github-style]) > p { margin-top: 0px; margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) > ul, .markdown-preview:not([data-use-github-style]) > ol { margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) blockquote { margin: 1.5em 0px; font-size: inherit; color: rgb(126, 126, 126); border-color: rgb(214, 214, 214); border-width: 4px; }
.markdown-preview:not([data-use-github-style]) hr { margin: 3em 0px; border-top: 2px dashed rgb(214, 214, 214); background: none; }
.markdown-preview:not([data-use-github-style]) table { margin: 1.5em 0px; }
.markdown-preview:not([data-use-github-style]) th { color: rgb(3, 3, 3); }
.markdown-preview:not([data-use-github-style]) th, .markdown-preview:not([data-use-github-style]) td { padding: 0.66em 1em; border: 1px solid rgb(214, 214, 214); }
.markdown-preview:not([data-use-github-style]) code { color: rgb(3, 3, 3); background-color: rgb(240, 240, 240); }
.markdown-preview:not([data-use-github-style]) pre.editor-colors { margin: 1.5em 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(245, 245, 245); }
.markdown-preview:not([data-use-github-style]) kbd { color: rgb(3, 3, 3); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(214, 214, 214) rgb(214, 214, 214) rgb(199, 199, 199); background-color: rgb(240, 240, 240); }
.markdown-preview[data-use-github-style] { font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif; line-height: 1.6; word-wrap: break-word; padding: 30px; font-size: 16px; color: rgb(51, 51, 51); overflow: scroll; background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview[data-use-github-style] h1, .markdown-preview[data-use-github-style] h2, .markdown-preview[data-use-github-style] h3, .markdown-preview[data-use-github-style] h4, .markdown-preview[data-use-github-style] h5, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview[data-use-github-style] h1 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview[data-use-github-style] h1 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] p, .markdown-preview[data-use-github-style] blockquote, .markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol, .markdown-preview[data-use-github-style] dl, .markdown-preview[data-use-github-style] table, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview[data-use-github-style] ul.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview[data-use-github-style] ul ul, .markdown-preview[data-use-github-style] ul ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left: 4px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview[data-use-github-style] table th, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] table tr { border-top: 1px solid rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] code, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview[data-use-github-style] code::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview[data-use-github-style] code::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: " "; }
.markdown-preview[data-use-github-style] code br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview[data-use-github-style] .highlight pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview[data-use-github-style] pre code, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview[data-use-github-style] pre code::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview[data-use-github-style] a { color: rgb(51, 122, 183); }
.markdown-preview[data-use-github-style] code { color: inherit; }
.markdown-preview[data-use-github-style] pre.editor-colors { padding: 0.8em 1em; margin-bottom: 1em; font-size: 0.85em; border-radius: 4px; overflow: auto; }
.scrollbars-visible-always .markdown-preview pre.editor-colors .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors .horizontal-scrollbar { visibility: hidden; }
.scrollbars-visible-always .markdown-preview pre.editor-colors:hover .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors:hover .horizontal-scrollbar { visibility: visible; }
.markdown-preview .task-list-item-checkbox { position: absolute; margin: 0.25em 0px 0px -1.4em; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

.spell-check-misspelling .region {
  border-bottom: 2px dotted rgba(255, 51, 51, 0.75);
}
.spell-check-corrections {
  width: 25em !important;
}

pre.editor-colors {
  background-color: white;
  color: #555;
}
pre.editor-colors .invisible-character {
  color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .indent-guide {
  color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .wrap-guide {
  background-color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .gutter {
  color: #555;
  background: white;
}
pre.editor-colors .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
pre.editor-colors .fold-marker:after {
  color: #e87b00;
}
pre.editor-colors .invisible {
  color: #555;
}
pre.editor-colors .selection .region {
  background-color: #e1e1e1;
}
pre.editor-colors .bracket-matcher .region {
  background-color: #C9C9C9;
  opacity: .7;
  border-bottom: 0 none;
}
pre.editor-colors.is-focused .cursor {
  border-color: black;
}
pre.editor-colors.is-focused .selection .region {
  background-color: #afc4da;
}
pre.editor-colors.is-focused .line-number.cursor-line-no-selection,
pre.editor-colors.is-focused .line.cursor-line {
  background-color: rgba(255, 255, 134, 0.34);
}
pre.editor-colors .syntax--source.syntax--gfm {
  color: #444;
}
pre.editor-colors .syntax--gfm .syntax--markup.syntax--heading {
  color: #111;
}
pre.editor-colors .syntax--gfm .syntax--link {
  color: #888;
}
pre.editor-colors .syntax--gfm .syntax--variable.syntax--list {
  color: #888;
}
pre.editor-colors .syntax--markdown .syntax--paragraph {
  color: #444;
}
pre.editor-colors .syntax--markdown .syntax--heading {
  color: #111;
}
pre.editor-colors .syntax--markdown .syntax--link {
  color: #888;
}
pre.editor-colors .syntax--markdown .syntax--link .syntax--string {
  color: #888;
}
.syntax--comment {
  color: #999988;
  font-style: italic;
}
.syntax--string {
  color: #D14;
}
.syntax--string .syntax--source,
.syntax--string .syntax--meta.syntax--embedded.syntax--line {
  color: #5A5A5A;
}
.syntax--string .syntax--punctuation.syntax--section.syntax--embedded {
  color: #920B2D;
}
.syntax--string .syntax--punctuation.syntax--section.syntax--embedded .syntax--source {
  color: #920B2D;
}
.syntax--constant.syntax--numeric {
  color: #D14;
}
.syntax--constant.syntax--language {
  color: #606aa1;
}
.syntax--constant.syntax--character,
.syntax--constant.syntax--other {
  color: #606aa1;
}
.syntax--constant.syntax--symbol {
  color: #990073;
}
.syntax--constant.syntax--numeric.syntax--line-number.syntax--find-in-files .syntax--match {
  color: rgba(143, 190, 0, 0.63);
}
.syntax--variable {
  color: #008080;
}
.syntax--variable.syntax--parameter {
  color: #606aa1;
}
.syntax--keyword {
  color: #222;
  font-weight: bold;
}
.syntax--keyword.syntax--unit {
  color: #445588;
}
.syntax--keyword.syntax--special-method {
  color: #0086B3;
}
.syntax--storage {
  color: #222;
}
.syntax--storage.syntax--type {
  color: #222;
}
.syntax--entity.syntax--name.syntax--class {
  text-decoration: underline;
  color: #606aa1;
}
.syntax--entity.syntax--other.syntax--inherited-class {
  text-decoration: underline;
  color: #606aa1;
}
.syntax--entity.syntax--name.syntax--function {
  color: #900;
}
.syntax--entity.syntax--name.syntax--tag {
  color: #008080;
}
.syntax--entity.syntax--other.syntax--attribute-name {
  color: #458;
  font-weight: bold;
}
.syntax--entity.syntax--name.syntax--filename.syntax--find-in-files {
  color: #E6DB74;
}
.syntax--support.syntax--constant,
.syntax--support.syntax--function,
.syntax--support.syntax--type {
  color: #458;
}
.syntax--support.syntax--class {
  color: #008080;
}
.syntax--invalid {
  color: #F8F8F0;
  background-color: #00A8C6;
}
.syntax--invalid.syntax--deprecated {
  color: #F8F8F0;
  background-color: #8FBE00;
}
.syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--string.syntax--quoted.syntax--double.syntax--json,
.syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--string.syntax--quoted.syntax--double.syntax--json .syntax--punctuation.syntax--string {
  color: #000080;
}
.syntax--meta.syntax--structure.syntax--dictionary.syntax--value.syntax--json > .syntax--string.syntax--quoted.syntax--double.syntax--json {
  color: #d14;
}
.syntax--meta.syntax--diff,
.syntax--meta.syntax--diff.syntax--header {
  color: #75715E;
}
.syntax--css.syntax--support.syntax--property-name {
  font-weight: bold;
  color: #333;
}
.syntax--css.syntax--constant {
  color: #099;
}
</style>
  </head>
  <body class='markdown-preview' data-use-github-style><h1 id="self-driving-car-engineer-project-4-advanced-lane-line-detection">Self Driving Car Engineer Project 4 - Advanced Lane Line Detection</h1>
<h2 id="benjamin-s-llner-22-jun-2017">Benjamin Söllner, 22 Jun 2017</h2>
<hr>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\project_carnd_4_finding_lane_lines_400.png" alt="Fun Project Header Image"></p>
<hr>
<p>The goals / steps of this project are the following:</p>
<ul>
<li>Compute the camera calibration matrix and distortion coefficients given a set of chessboard images.</li>
<li>Apply a distortion correction to raw images.</li>
<li>Use color transforms, gradients, etc., to create a thresholded binary image.</li>
<li>Apply a perspective transform to rectify binary image (&quot;birds-eye view&quot;).</li>
<li>Detect lane pixels and fit to find the lane boundary.</li>
<li>Determine the curvature of the lane and vehicle position with respect to center.</li>
<li>Warp the detected lane boundaries back onto the original image.</li>
<li>Output visual display of the lane boundaries and numerical estimation of lane curvature and vehicle position.</li>
</ul>
<h2 id="rubric-points">Rubric Points</h2>
<p>Here I will consider the <a href="https://review.udacity.com/#!/rubrics/571/view">rubric points</a> individually and describe how I addressed each point in my implementation. Code references are made to CELLs of the <a href="CarND 04 Advanced Lane Line Detection.ipynb">Python Notebook</a> (<a href="CarND 04 Advanced Lane Line Detection.html">HTML Version</a>). In the python notebook, you can also see the <em>Task #...</em>s from the rubric referenced that we will reference here.</p>
<h3 id="task-1-compute-the-camera-matrix-and-distortion-coefficients-provide-an-example-of-a-distortion-corrected-calibration-image-">Task #1: Compute the camera matrix and distortion coefficients. Provide an example of a distortion corrected calibration image.</h3>
<p>The camera matrix has been implemented in CELL 2. Chessboard corners have been found for all calibration images in line 26 ...</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>returncode</span><span>,&nbsp;</span><span>corners</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>findChessboardCorners</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>gray</span><span>,&nbsp;</span><span>(</span><span>cal_rows</span><span>,</span><span>cal_cols</span><span>)</span><span>,&nbsp;</span><span class="syntax--constant syntax--language syntax--python"><span>None</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<p>... appended to the object points array after which an undistortion is performed in CELL 3 with said points (line 8f.) ...</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>cal_ret</span><span>,&nbsp;</span><span>cal_matrix</span><span>,&nbsp;</span><span>cal_dist</span><span>,&nbsp;</span><span>cal_rvecs</span><span>,&nbsp;</span><span>cal_tvecs</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--separator syntax--continuation syntax--line syntax--python"><span>\</span></span><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>calibrateCamera</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>cal_objpoints</span><span>,&nbsp;</span><span>cal_imgpoints</span><span>,&nbsp;</span><span>cal_test_image_size</span><span>,&nbsp;</span><span class="syntax--constant syntax--language syntax--python"><span>None</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--language syntax--python"><span>None</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<p>The calibration parameters (<code>cal_*</code> variables) are saved &amp; restored via a pickle file which is used to undistort the images. A <code>undistort(...)</code> function is implemented in CELL 4 which calls <code>cv2.undistort(...)</code> with the correct paramaters (line 12):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--keyword syntax--control syntax--statement syntax--python"><span>return</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>undistort</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>image</span><span>,&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span>CAL_PICKLE</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--string syntax--quoted syntax--double syntax--single-line syntax--python"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--python"><span>&quot;</span></span><span>matrix</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--python"><span>&quot;</span></span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span>,&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span>CAL_PICKLE</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--string syntax--quoted syntax--double syntax--single-line syntax--python"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--python"><span>&quot;</span></span><span>dist</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--python"><span>&quot;</span></span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span>,&nbsp;</span><span class="syntax--constant syntax--language syntax--python"><span>None</span></span><span>,&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span>CAL_PICKLE</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--string syntax--quoted syntax--double syntax--single-line syntax--python"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--python"><span>&quot;</span></span><span>matrix</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--python"><span>&quot;</span></span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<p>Here is an example of this function applied to a checkerboard image:</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_1_undistortion_checkerboard.png" alt="Undistortion of Checkerboard Images"></p>
<h3 id="task-2-provide-an-example-of-a-distortion-corrected-image-">Task #2: Provide an example of a distortion-corrected image.</h3>
<p>The <code>undistort(...)</code>-function can be equally applied to the test images. Here is an example of that (see also CELL 5):</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_2_undistortion_image.png" alt="Undistortion of Test Image"></p>
<h3 id="task-3-perform-a-perspective-transform-and-provide-an-example-of-a-transformed-image-">Task #3: Perform a perspective transform and provide an example of a transformed image.</h3>
<p>Perspective transformation is done by identifying a trapezoid on the lower area of a straight-lane image and warping this image into a flat area, carefully trying to straighten out the lane lines.</p>
<p>This is done in CELL 6. The trapezoid is defined in a global variable <code>UNWARP_PLANE</code> (CELL 1), the vertical and horizontal margin is configured via <code>UNWARP_X_OFFSET</code> and <code>UNWARP_Y_OFFSET</code> (CELL 1).  </p>
<p>The <code>unwarp(...)</code> function in CELL 6 can be applied to any image and unwarps it using these globally defined variables (see lines 22-24):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>transform_matrix</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>getPerspectiveTransform</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>float32</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>source</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>,&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>float32</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>dest</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>inverse_matrix</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>getPerspectiveTransform</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>float32</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>dest</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>,&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>float32</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>source</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>unwarped</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>warpPerspective</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>undistorted</span><span>,&nbsp;</span><span>transform_matrix</span><span>,&nbsp;</span><span>dim</span><span>,&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>flags</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>cv2</span><span>.</span><span>INTER_LINEAR</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<p>Here is an example of the undistorted and unwarped image:</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_3_unwarping.png" alt="Unwarping of Test Image"></p>
<h3 id="task-4-use-color-transforms-gradients-or-other-methods-to-create-a-thresholded-binary-image-provide-an-example-of-a-binary-image-result-">Task #4: Use color transforms, gradients or other methods to create a thresholded binary image. Provide an example of a binary image result.</h3>
<p>Several functions, that create threshold images have been created. CELL 7 defines <code>*_threshold(...)</code> functions that can be applied to an image and return different possible thresholds that could be logically combined:</p>
<ul>
<li><code>mag_threshold(...)</code> creates a Sobel-Magnitude threshold for every pixel with a kernel of (default) 5 and a threshold between 10 and 130 (as tuned by the global variable <code>THRESH_MAG</code>)</li>
<li><code>dir_threshold(...)</code> creates a Sobel-Directional threshold for every pixel with a kernel of (default) 5 and a threshold lower than 0.7 or higher than 1.5 (as tuned by the global variable <code>THRESH_DIR</code>)</li>
<li><code>s_threshold(...)</code> creates a S-of-HLS-channel threshold with a threshold between 15 and 255 (as tuned by the global variable <code>THRESH_S</code>)</li>
<li><code>l_threshold(...)</code> creates a S-of-HLS-channel threshold with a threshold between a defined upper and lower bound, e.g., 70 and 90</li>
<li><code>yellow_threshold(...)</code> aims to catch the yellow line images by applying thresholding in all three channels of the HSV space (CELL 7, lines 76-84)</li>
<li><code>white_threshold(...)</code> applies a mixture of thresholdings in the HSV, HLS and RGB space to catch white pixels and marks a union of all pixels found (CELL 7, lines 88-103)</li>
</ul>
<p>Below, you can see the filters in action for test image <code>test6.jpg</code>:</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_4_thresholds.png" alt="Binary Images of Different Thresholds"></p>
<p>A simple union of the <code>yellow_threshold(...)</code> and the <code>white_threshold(...)</code> pixels was sufficient to do the job, see the &quot;Binary Image&quot; below. All other thresholdings added too much noise. Also see below, in the second row, a mapping of the 6 thresholdings to two RGB images, in order to asess how certain thresholdings compliment each other:</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_4_thresholds_channels.png" alt="Thresholds mapped to RGB channels and output binary image"></p>
<h3 id="task-5-identify-lane-line-pixels-and-fit-their-positions-with-a-polynomial-">Task #5: Identify lane-line pixels and fit their positions with a polynomial?</h3>
<p>Lane line pixel finding was done with a combination of <em>slidewindow search</em> and <em>proximity search</em> as described <a href="https://classroom.udacity.com/nanodegrees/nd013/parts/fbf77062-5703-404e-b60c-95b78b2f3f9e/modules/2b62a1c3-e151-4a0e-b6b6-e424fa46ceab/lessons/40ec78ee-fb7c-4b53-94a8-028c5c60b858/concepts/c41a4b6b-9e57-44e6-9df9-7e4e74a1a49a">in the course</a>.</p>
<h4 id="slidewindow-search">Slidewindow Search</h4>
<p>In order to find the lower bounds where to start the slidewindow search, the aggregated brightness across the y-dimension has been taken across the lower half of the image (CELL 9, function <code>whiteness_half_across_y(...)</code>) and then global maxima have been searched left and right of the center of the sequence (CELL 9, function <code>find_peaks(...)</code>). Here is an image of this sequence, including the peaks (in red):</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_5_find_lane_line_base.png" alt=""></p>
<p>The vertical space of the image is divided into 9 sliding windows which follow the lane line progression from bottom of the image to the top. The lane line pixels are collected from the binary image retrieved by <code>find_lane_line_pixels(...)</code> across the sliding windows (see CELL 12, line 41 and 57)</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>w_left_idxs</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>(</span><span>(</span><span>nonzeroy</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&gt;=</span></span><span>&nbsp;</span><span>w_y_lo</span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>&amp;</span></span><span>&nbsp;</span><span>(</span><span>nonzeroy</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&lt;</span></span><span>&nbsp;</span><span>w_y_hi</span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>&amp;</span></span><span>&nbsp;</span><span>(</span><span>nonzerox</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&gt;=</span></span><span>&nbsp;</span><span>w_xleft_lo</span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>&amp;</span></span><span>&nbsp;</span><span>(</span><span>nonzerox</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&lt;</span></span><span>&nbsp;</span><span>w_xleft_hi</span><span>)</span><span>)</span><span>.</span><span class="syntax--meta syntax--function-call syntax--python"><span>n</span><span>onzero</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span class="syntax--meta syntax--structure syntax--list syntax--python"><span class="syntax--punctuation syntax--definition syntax--list syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--structure syntax--list syntax--item syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--list syntax--end syntax--python"><span>]</span></span></span></span></div></pre>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>w_right_idxs</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>(</span><span>(</span><span>nonzeroy</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&gt;=</span></span><span>&nbsp;</span><span>w_y_lo</span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>&amp;</span></span><span>&nbsp;</span><span>(</span><span>nonzeroy</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&lt;</span></span><span>&nbsp;</span><span>w_y_hi</span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>&amp;</span></span><span>&nbsp;</span><span>(</span><span>nonzerox</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&gt;=</span></span><span>&nbsp;</span><span>w_xright_lo</span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>&amp;</span></span><span>&nbsp;</span><span>(</span><span>nonzerox</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&lt;</span></span><span>&nbsp;</span><span>w_xright_hi</span><span>)</span><span>)</span><span>.</span><span class="syntax--meta syntax--function-call syntax--python"><span>n</span><span>onzero</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span class="syntax--meta syntax--structure syntax--list syntax--python"><span class="syntax--punctuation syntax--definition syntax--list syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--structure syntax--list syntax--item syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--list syntax--end syntax--python"><span>]</span></span></span></span></div></pre>
<p>In addition to the algorithm developed in the course, there is a &quot;giveup&quot; counter for the sliding windows: in case that a certain number of sliding windows does not find lane lines when moving up the image the search is preliminarily terminated. This was added in order to avoid falsely classifying especially the noisy area at the top of the images as lane line images, e.g. for the left lane line (CELL 12 lines 28ff.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>giveup_left</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;[...]</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--keyword syntax--control syntax--repeat syntax--python"><span>for</span></span><span>&nbsp;</span><span>w</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--logical syntax--python"><span>in</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span class="syntax--support syntax--function syntax--builtin syntax--python"><span>range</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>nwindows</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>:</span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;[...&nbsp;iterate&nbsp;through&nbsp;sliding&nbsp;windows&nbsp;...]</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--conditional syntax--python"><span>if</span></span><span>&nbsp;</span><span>giveup_left</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&lt;</span></span><span>&nbsp;</span><span>giveupafter</span><span>:</span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;[...&nbsp;find&nbsp;lane&nbsp;line&nbsp;pixels&nbsp;on&nbsp;the&nbsp;left&nbsp;...]</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--conditional syntax--python"><span>if</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span class="syntax--support syntax--function syntax--builtin syntax--python"><span>len</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>w_left_idxs</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&gt;</span></span><span>&nbsp;</span><span>minpix</span><span>:</span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;[...&nbsp;update&nbsp;sliding&nbsp;window&nbsp;center&nbsp;...]</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--conditional syntax--python"><span>else</span></span><span>:</span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;or&nbsp;update&nbsp;counter&nbsp;of&nbsp;unsuccessful&nbsp;sliding&nbsp;windows</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>giveup_left</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--augmented syntax--python"><span>+=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>1</span></span></span></div></pre>
<p>After the slidewindow search a second-order polynomial is fit through the points that had been found (CELL 12, lines 85ff., for the <code>LaneLine.sample_poly(...)</code> function, see CELL 10, lines 19f.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>left_fit_xs</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>left_line</span><span>.</span><span>sample_poly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>fit_ys</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>right_fit_xs</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>right_line</span><span>.</span><span>sample_poly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>fit_ys</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;Sample&nbsp;the&nbsp;fitted&nbsp;polygon&nbsp;across&nbsp;a&nbsp;number&nbsp;of&nbsp;y&nbsp;points</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--meta syntax--function syntax--python"><span class="syntax--storage syntax--type syntax--function syntax--python"><span>def</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--python"><span>sample_poly</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function syntax--parameters syntax--python"><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>self</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>ys</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>yoffset</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--python"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--function syntax--begin syntax--python"><span>:</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--statement syntax--python"><span>return</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>ys</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span><span>*</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>1</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>ys</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span>yoffset</span></span></div></pre>
<p>Here is a sample output of the slidewindow output:</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_5_slidewindow_search.png" alt="Slidewindow search output of the test images"></p>
<h4 id="proximity-search">Proximity Search</h4>
<p>In addition to the slidewindow search, once lanes have been found, subsequent lanes are searched for with a proximity search in the area of the old lane lines. The code for this can be found in CELL 13, e.g. lines 12ff.:</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>left_idxs</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>(</span><span>(</span><span>nonzerox</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&gt;</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>old_lane</span><span>.</span><span>left</span><span>.</span><span>sample_poly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>nonzeroy</span><span>,&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>yoffset</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>-</span></span><span>pmargin</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>&amp;</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--separator syntax--continuation syntax--line syntax--python"><span>\</span></span><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>(</span><span>nonzerox</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&lt;</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>old_lane</span><span>.</span><span>left</span><span>.</span><span>sample_poly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>nonzeroy</span><span>,&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>yoffset</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>pmargin</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>)</span><span>)</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>right_idxs</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>(</span><span>(</span><span>nonzerox</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&gt;</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>old_lane</span><span>.</span><span>right</span><span>.</span><span>sample_poly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>nonzeroy</span><span>,&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>yoffset</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>-</span></span><span>pmargin</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>&amp;</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--separator syntax--continuation syntax--line syntax--python"><span>\</span></span><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>(</span><span>nonzerox</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&lt;</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>old_lane</span><span>.</span><span>right</span><span>.</span><span>sample_poly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>nonzeroy</span><span>,&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>yoffset</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>pmargin</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>)</span><span>)</span></span></div></pre>
<p>In the following image, you can see how the proximity search works (for this example for the sake of simplicity, we are just retrieving the lane lines on the very same image and then doing the proximity search on the same image):</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_5_proximity_search.png" alt="Proximity search output of the test images"></p>
<h4 id="combining-both-strategies">Combining Both strategies</h4>
<p>Both strategies (<code>slidewindow_search(...)</code> and <code>proximity_search(...)</code>) are combined (<code>combined_search(...)</code>, CELL 14). The following strategies are used to trade off both strategies and sanity-check both of them:</p>
<ul>
<li>If either of the two methods do not find a lane (because the left or right lane does not contain lane line pixels), the other strategy is used.</li>
<li>If no previous image &amp; lane was provided, the slidewindow search will be used.</li>
<li><p>If a previous image &amp; lane was provided, this lane is averaged with the newly found lane (CELL 14 line 19+24, the &quot;+&quot; and &quot;/&quot; operator is overloaded in the &quot;Lane&quot; and &quot;LaneLine&quot; class, see CELL 10 and 11):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>slidewindow_lane_avg</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>(</span><span>old_lane</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span>slidewindow_lane</span><span>)</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>/</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span></span></div></pre>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>proximity_lane_avg</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>(</span><span>old_lane</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span>proximity_lane</span><span>)</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>/</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span></span></div></pre>
</li>
<li><p>If both searches return results, the lane with the lowest &quot;insanity&quot; is used. As metric for &quot;insanity&quot; the standard deviation of the lane line width across the image is used (see CELL 14 line 26ff. and CELL 11 lines 15ff.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--keyword syntax--control syntax--conditional syntax--python"><span>if</span></span><span>&nbsp;</span><span>(</span><span>proximity_insanity</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--python"><span>&lt;</span></span><span>&nbsp;</span><span>slidewindow_insanity</span><span>)</span><span>:</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;</span><span>next_lane</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>proximity_lane_avg</span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--keyword syntax--control syntax--conditional syntax--python"><span>else</span></span><span>:</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;</span><span>next_lane</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>slidewindow_lane_avg</span></span></div></pre>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;&quot;Insanity&quot;&nbsp;of&nbsp;a&nbsp;lane&nbsp;is&nbsp;high&nbsp;in&nbsp;case&nbsp;the&nbsp;lane&nbsp;width&nbsp;varies&nbsp;a&nbsp;lot</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--meta syntax--function syntax--python"><span class="syntax--storage syntax--type syntax--function syntax--python"><span>def</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--python"><span>insanity</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function syntax--parameters syntax--python"><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>self</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>ys</span></span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--python"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--function syntax--begin syntax--python"><span>:</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;</span><span>ds</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--structure syntax--list syntax--python"><span class="syntax--punctuation syntax--definition syntax--list syntax--begin syntax--python"><span>[</span></span><span class="syntax--punctuation syntax--definition syntax--list syntax--end syntax--python"><span>]</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;iterate&nbsp;across&nbsp;y-values&nbsp;and&nbsp;collect&nbsp;all&nbsp;lane&nbsp;widths</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--repeat syntax--python"><span>for</span></span><span>&nbsp;</span><span>y</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--logical syntax--python"><span>in</span></span><span>&nbsp;</span><span>ys</span><span>:</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>l</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>left</span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>ys</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span><span>*</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>left</span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>1</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>ys</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>left</span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>r</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>right</span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>ys</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span><span>*</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>right</span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>1</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>ys</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>right</span><span>.</span><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>ds</span><span>.</span><span>append</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>r</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>-</span></span><span>l</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;get&nbsp;standard&nbsp;deviation&nbsp;of&nbsp;lane&nbsp;widths</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--statement syntax--python"><span>return</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>std</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>ds</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
</li>
<li><p>If both proximity search and slidewindow search return no lane, the previous line is kept.</p>
</li>
</ul>
<h3 id="task-6-calculate-the-radius-of-curvature-of-the-lane-and-the-position-of-the-vehicle-with-respect-to-center-">Task #6: Calculate the radius of curvature of the lane and the position of the vehicle with respect to center.</h3>
<p>In the code&#39;s <code>Lane</code> class, there are two functions to calculate the lane radius and current offset-from-center (CELL 11, 9ff. and 27ff.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;Curvature&nbsp;of&nbsp;a&nbsp;lane&nbsp;is&nbsp;defined&nbsp;as&nbsp;average&nbsp;curvature&nbsp;of&nbsp;the&nbsp;left&nbsp;+&nbsp;right&nbsp;lane&nbsp;line</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--meta syntax--function syntax--python"><span class="syntax--storage syntax--type syntax--function syntax--python"><span>def</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--python"><span>curvature</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function syntax--parameters syntax--python"><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>self</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>y</span></span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--python"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--function syntax--begin syntax--python"><span>:</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>l</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>left</span><span>.</span><span>curvature</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>y</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>r</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>right</span><span>.</span><span>curvature</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>y</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--statement syntax--python"><span>return</span></span><span>&nbsp;</span><span>(</span><span>l</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>r</span><span>)</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>/</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span></span></div></pre>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;Calculate&nbsp;offset&nbsp;from&nbsp;center&nbsp;by&nbsp;looking&nbsp;at&nbsp;x_vehicle_center&nbsp;in&nbsp;respect&nbsp;to&nbsp;left&nbsp;and&nbsp;right&nbsp;lane&nbsp;position</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--meta syntax--function syntax--python"><span class="syntax--storage syntax--type syntax--function syntax--python"><span>def</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--python"><span>offset_from_center</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function syntax--parameters syntax--python"><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>self</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>y</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>x_vehicle_center</span></span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--python"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--function syntax--begin syntax--python"><span>:</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--modifier syntax--global syntax--python"><span>global</span></span><span>&nbsp;</span><span>LANE_X_M_PER_PIX</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>x_l</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>left</span><span>.</span><span>sample_poly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>y</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>x_r</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>right</span><span>.</span><span>sample_poly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>y</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>x_lane_center</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>(</span><span>x_r</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>-</span></span><span>x_l</span><span>)</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>/</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--statement syntax--python"><span>return</span></span><span>&nbsp;</span><span>(</span><span>x_lane_center</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>-</span></span><span>x_vehicle_center</span><span>)</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>LANE_X_M_PER_PIX</span></span></div></pre>
<p>The <code>curvature(...)</code> function of the <code>Lane</code> class relies on the <code>curvature(...)</code> function (CELL 10, lines 22ff.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;Calculate&nbsp;the&nbsp;curvature&nbsp;of&nbsp;the&nbsp;polygon</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--meta syntax--function syntax--python"><span class="syntax--storage syntax--type syntax--function syntax--python"><span>def</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--python"><span>curvature</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function syntax--parameters syntax--python"><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>self</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>y</span></span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--python"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--function syntax--begin syntax--python"><span>:</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--modifier syntax--global syntax--python"><span>global</span></span><span>&nbsp;</span><span>LANE_Y_M_PER_PIX</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--modifier syntax--global syntax--python"><span>global</span></span><span>&nbsp;</span><span>LANE_X_M_PER_PIX</span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;re-fit&nbsp;the&nbsp;polygon&nbsp;in&nbsp;world-space</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>fit</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>polyfit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>ys</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>LANE_Y_M_PER_PIX</span><span>,&nbsp;</span><span class="syntax--variable syntax--language syntax--self syntax--python"><span>self</span></span><span>.</span><span>xs</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>LANE_X_M_PER_PIX</span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--statement syntax--python"><span>return</span></span><span>&nbsp;</span><span>(</span><span>(</span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span>(</span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span class="syntax--meta syntax--item-access syntax--python"><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>y</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span>LANE_Y_M_PER_PIX</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>+</span></span><span>&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>1</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span>)</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span><span>*</span></span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span><span>)</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span><span>*</span></span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.5</span></span><span>)</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>/</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>absolute</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>2</span></span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>*</span></span><span class="syntax--meta syntax--item-access syntax--python"><span>fit</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<h3 id="task-7-plot-result-back-down-onto-the-road-such-that-the-lane-area-is-identified-clearly-">Task #7: Plot result back down onto the road such that the lane area is identified clearly.</h3>
<p>CELL 15 plots the lane as a polygon (<code>update_lane(...)</code>, line 13f.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>pts</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>hstack</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>(</span><span>right_pts</span><span>,&nbsp;</span><span>left_pts</span><span>)</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>fillPoly</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>image</span><span>,&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>int_</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>pts</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span><span>,&nbsp;</span><span>laneColor</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<p>It also includes a stepping function that takes in a previous lane and an image and generates an output lane image and a new lane object (line 17ff.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;Stepping&nbsp;function:&nbsp;for&nbsp;a&nbsp;given&nbsp;new_image&nbsp;&amp;&nbsp;old_lane,&nbsp;calculate&nbsp;a&nbsp;new_lane&nbsp;and&nbsp;a&nbsp;lane&nbsp;line&nbsp;image&nbsp;(lane_img)</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--meta syntax--function syntax--python"><span class="syntax--storage syntax--type syntax--function syntax--python"><span>def</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--python"><span>update_lane</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function syntax--parameters syntax--python"><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>old_lane</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>new_image</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>laneColor</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>(</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>)</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--python"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--function syntax--begin syntax--python"><span>:</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>new_lane</span><span>,&nbsp;</span><span>out_img</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>combined_search</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>old_lane</span><span>,&nbsp;</span><span>new_image</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>lane_img</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>float_</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span class="syntax--meta syntax--function-call syntax--python"><span>np</span><span>.</span><span>zeros_like</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>new_image</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>plot_lane</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>lane_img</span><span>,&nbsp;</span><span>new_lane</span><span>,&nbsp;</span><span>laneColor</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--statement syntax--python"><span>return</span></span><span>&nbsp;</span><span>new_lane</span><span>,&nbsp;</span><span>lane_img</span></span></div></pre>
<p>The image is used in the <code>update_warp(...)</code> function in CELL 16, where it&#39;s warped back onto the image and layed over with the respective metrics (line 26ff.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;Stepping&nbsp;function:&nbsp;for&nbsp;a&nbsp;given&nbsp;new_image&nbsp;&amp;&nbsp;old_lane,&nbsp;calculate&nbsp;a&nbsp;new_lane&nbsp;and&nbsp;an&nbsp;output&nbsp;image</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;displaying&nbsp;the&nbsp;lane&nbsp;metrics&nbsp;and&nbsp;lane&nbsp;polygon</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--meta syntax--function syntax--python"><span class="syntax--storage syntax--type syntax--function syntax--python"><span>def</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--python"><span>update_warp</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function syntax--parameters syntax--python"><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>old_lane</span></span><span class="syntax--punctuation syntax--separator syntax--parameters syntax--python"><span>,</span></span><span>&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>new_image</span></span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--python"><span>)</span></span><span class="syntax--punctuation syntax--section syntax--function syntax--begin syntax--python"><span>:</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--modifier syntax--global syntax--python"><span>global</span></span><span>&nbsp;</span><span>UNWARP_INV_MATRIX</span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>dim</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span>(</span><span class="syntax--meta syntax--item-access syntax--python"><span>new_image</span><span>.</span><span>shape</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>1</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span>,&nbsp;</span><span class="syntax--meta syntax--item-access syntax--python"><span>new_image</span><span>.</span><span>shape</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>[</span></span><span class="syntax--meta syntax--item-access syntax--arguments syntax--python"><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>]</span></span></span><span>)</span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;undistort&nbsp;image</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>out_image</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>undistort</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>new_image</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;calculate&nbsp;lane&nbsp;and&nbsp;lane-image</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>lane</span><span>,&nbsp;</span><span>lane_image</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>update_lane</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>old_lane</span><span>,&nbsp;</span><span>new_image</span><span>,&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>laneColor</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>(</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>)</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;warp&nbsp;lane-image&nbsp;back&nbsp;onto&nbsp;original&nbsp;image</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>warp_lane_image</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>warpPerspective</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>lane_image</span><span>,&nbsp;</span><span>UNWARP_INV_MATRIX</span><span>,&nbsp;</span><span>dim</span><span>,&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>flags</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>cv2</span><span>.</span><span>INTER_LINEAR</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>out_image</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>cv2</span><span>.</span><span>addWeighted</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>out_image</span><span class="syntax--keyword syntax--operator syntax--arithmetic syntax--python"><span>/</span></span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>255.</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>0.7</span></span><span>,&nbsp;</span><span>warp_lane_image</span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>0.3</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--integer syntax--decimal syntax--python"><span>0</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--number-sign syntax--python"><span class="syntax--punctuation syntax--definition syntax--comment syntax--python"><span>#</span></span><span>&nbsp;write&nbsp;metrics&nbsp;onto&nbsp;image</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>plot_metrics</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>out_image</span><span>,&nbsp;</span><span>lane</span><span>,&nbsp;</span><span class="syntax--variable syntax--parameter syntax--function syntax--python"><span>textColor</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>(</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--float syntax--python"><span>1.</span></span><span>)</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div><div class="line"><span class="syntax--source syntax--python"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--statement syntax--python"><span>return</span></span><span>&nbsp;</span><span>lane</span><span>,&nbsp;</span><span>out_image</span></span></div></pre>
<p>Here are all test images with warped lanes and added metrics:</p>
<p><img src="\\Sstr121f.edc.corpintra.net\bsoelln$\data\My Documents\GitHub\CarND_04_AdvancedLaneFinding\writeup_images\task_7_plot_lane.png" alt="Warped lane onto and added metrics to test images"></p>
<h3 id="task-8-provide-a-link-to-your-final-video-output-your-pipeline-should-perform-reasonably-well-on-the-entire-project-video-wobbly-lines-are-ok-but-no-catastrophic-failures-that-would-cause-the-car-to-drive-off-the-road-">Task #8: Provide a link to your final video output. Your pipeline should perform reasonably well on the entire project video (wobbly lines are ok but no catastrophic failures that would cause the car to drive off the road!)</h3>
<p>CELL 17 provides a function <code>process_frame(...)</code> which stores the current lane line in a global variable <code>process_lane_buffer</code> and updates it with every step (line 14f.):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>process_lane_buffer</span><span>,&nbsp;</span><span>image</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>update_warp</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>process_lane_buffer</span><span>,&nbsp;</span><span>image</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<p>This is done since the <code>VideoClipFile.fl_image(...)</code> function only takes framewise processing functions that take and return exactly one argument, the (to-be-) transformed image (line 22):</p>
<pre class="editor-colors lang-python"><div class="line"><span class="syntax--source syntax--python"><span>video_out_clip</span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--python"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--python"><span>video_in_clip</span><span>.</span><span>fl_image</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--python"><span>(</span></span><span class="syntax--meta syntax--function-call syntax--arguments syntax--python"><span>process_frame</span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--python"><span>)</span></span></span></span></div></pre>
<p>CELL 18 processes the whole video. Here&#39;s a <a href="./project_video_output.mp4">link to my video result</a>.</p>
<video width="960" height="540" controls><source src="./project_video_output.mp4"></source></video>

<h2 id="task-9-briefly-discuss-any-problems-issues-you-faced-in-your-implementation-of-this-project-where-will-your-pipeline-likely-fail-what-could-you-do-to-make-it-more-robust-">Task #9: Briefly discuss any problems / issues you faced in your implementation of this project. Where will your pipeline likely fail? What could you do to make it more robust?</h2>
<p>The main challenge was finding the right threshold (with lots of trials-and-errors over test images and the video).</p>
<p>Here are a few thoughts how this project could still be improved:</p>
<ul>
<li>Smoothing could be implemented over a larger number of lanes. This would need adaption of the data structure</li>
<li>Certain lane fits could be discarded as &quot;totally insane&quot; (like if curvature or lane width variation is too unrealistic)</li>
<li>Sobel or L/S threshold could be re-considered, if a low-pass filtering would be applied that removes noise from the related binary images</li>
<li>Some other form of outlier rejection of the binary image could be introduced.</li>
<li>Lane base detection could be implemented with local maxima</li>
<li>Heuristics could be implemented to detect when a driver is changing lanes over time, therefore shifting the middle of the lane to the side the driver is steering towards</li>
</ul>
<h2 id="files-submitted">Files Submitted</h2>
<p>My project includes the following files:</p>
<ul>
<li><a href="CarND%2004%20Advanced%20Lane%20Line%20Detection.ipynb"><code>CarND 04 Advanced Lane Line Detection.ipynb</code></a> / <a href="CarND%2004%20Advanced%20Lane%20Line%20Detection.html"><code>.html</code></a>: the (rendered) iPython notebook with the algorithm</li>
<li><a href="writeup_report.md"><code>writeup_report.md</code></a> / <a href="writeup_report.html"><code>.html</code></a>: the writeup of this project including the showcase images (you are reading it)</li>
<li><a href="project_video_output.mp4"><code>project_video_output.mp4</code></a>: the output video with lane line markings and lane metrics</li>
</ul></body>
</html>
